"use strict";function loadPartials(t){Utils.loadPartials(null,null,t)}function onLoadPartials(){$(document).trigger("fg.partials.complete"),$.material.init(),Toasts.init("#toastStack","#toastTemplate"),LocalStorage.init();var t=LocalStorage.get("localAppVer");t!=Settings.appVer?(console.log("UPDATE APP VERSION... "+t+" --> "+Settings.appVer),LocalStorage.set("localAppVer",Settings.appVer)):console.log("CURRENT APP VERSION "+t),initModals(),Auth.initLogin(),initSpyPassword(),initCheckbox(),initRadioCarousels(),initShowPasswordToggles(),initHandlebarsPartials(),initConfirmationOkModal(),initSmoothScrollControls(),initDisableOn(),initCollapsibles(),initSmartTables(),UI.initCountdown(),UI.initServerMessages(),UI.initImgManager(),UI.initTooltips(),UI.initPopovers(),UI.initCircularProgressBar(),initGlobalMenu(),initRanks(),initFilters(),UI.initToggleStatus(),UI.initMultiselects(),UI.initDateTimePickers(),UI.initDataPicker(),UI.initAutoTrim(),UI.initChosen(),UI.initDismisser(),UI.initColorPickers(),UI.initCounters(),UI.initCountdowns(),UI.initRestricts(),UI.initInputPattern(),UI.initInputPoints(),UI.initLimitedInputs(),UI.initSortableList(),UI.initSliders(),UI.initSelectPicker(),UI.initLazyLoad(),UI.initRepeatRemove(),UI.initPropagateClick(),UI.initRichTextField(),UI.initAttachments(),UI.initSticky(),UI.initAutoColspan(),UI.initSynchHref(),initCheckboxToggle(),Layout.init(),$(document).trigger("fg.init.complete"),$("body").toggleClass("mobile",Globals.isMobile).toggleClass("desktop",!Globals.isMobile).toggleClass("ios",Globals.isIos),$("body").addClass("init-complete")}function initModals(){$(".modal").on("show.bs.modal",function(t){$(t.target).find(".auto-clear").children().remove()}),$(".modal").on("shown.bs.modal",function(t){$(t.target).find(".form-control:first()").focus()})}function initSpyPassword(){$("input.spy-password").on("keyup search input paste cut mouseenter",function(t){var e="password"==this.type?this.value:"";$(this).attr("data-original-title",e).tooltip("fixTitle").tooltip(e.length>0?"show":"hide")}),$("input.spy-password").tooltip({animation:!0,placement:"bottom",template:'<div class="spy-password tooltip" role="tooltip"><div class="tooltip-inner"></div></div>'})}function initCheckbox(){$(document).on("change",'.form-group .radio label > input[type="radio"]',function(t){$(this).closest(".form-group").find('.radio:has([name="'+this.name+'"])').removeClass("is-checked").end().find('.radio:has([value="'+this.value+'"])').addClass("is-checked")}),$('.form-group .radio label > input[type="radio"]:checked').closest(".radio").addClass("is-checked")}function initRadioCarousels(){$(".carousel[data-radio-controller]").each(function(){var t=$(this),e=t.attr("data-radio-controller"),a=$("input[name="+e+"]"),n=t.find(".carousel-inner"),i={};a.each(function(t){i[this.value||t]=t}),a.change(function(){t.carousel(Number(i[this.value]));var e=t.find(".item.prev, .item.next").outerHeight(!0);n.animate({height:e},function(){var t=this;setTimeout(function(){t.style.height=""},500)})}),$("input[name="+e+"]:checked").each(function(){t.carousel(Number(i[this.value]))})})}function initShowPasswordToggles(){$(document).on("click","[data-show-password]",function(){var t=$(this);$(t.attr("data-show-password")).each(function(){var t="password"==this.type;this.type=t?"input":"password"}),t.toggleClass("show-password")})}function initCollapsibles(){$(document).on("hide.bs.collapse",function(t){var e=t.target.id;e&&$('[data-toggle="collapse"][data-target="#'+e+'"]').parent().addClass("collapse-closed"),window.event&&$(window.event.target).closest(".btn").addClass("collapser-closed").removeClass("collapser-open")}),$(document).on("show.bs.collapse",function(t){var e=t.target.id;e&&$('[data-toggle="collapse"][data-target="#'+e+'"]').parent().addClass("collapse-open"),window.event&&$(window.event.target).closest(".btn").addClass("collapser-open").removeClass("collapser-closed")}),$(document).on("click",'[href][data-toggle="collapse"]',function(t){t.preventDefault()})}function initSmartTables(){$(document).on("mouseenter click",".smart-table [data-key]",function(t){var e=$(t.target).closest("[data-key]"),a=e.closest(".smart-table"),n=e.attr("data-key"),i=a.find('th[data-key="'+n+'"]'),o=a.find('[data-key="'+n+'"]');i.is(".disable-highlight-col")||o.addClass("highlight");var r=1/0,s=null,l=-(1/0),c=null;o.each(function(){var t=$(this),e=Utils.parseFloat(t.text().replace(/,/,"."));isNaN(e)||(e>l?(c=t,l=e):e==l&&(c=c.add(this)),e<r?(s=t,r=e):e==r&&s.add(this))}),c&&!i.is(".disable-highlight-max")&&c.addClass("max"),s&&!i.is(".disable-highlight-min")&&s.addClass("min")}),$(document).on("mouseleave",".smart-table [data-key]",function(t){$(".smart-table [data-key]").removeClass("highlight min max")})}function initHandlebarsPartials(){Utils.wrap(".handlebar-partial")}function resendConfirmationEmail(t){var e=$(t),a=$("body");e.prop("disabled",!0),a.addClass("resending-confirmation"),Api.sendConfirmation(Globals.userInfo.data.utente.id,function(t){e.prop("disabled",!1),t&&t.success?(a.removeClass("resending-confirmation"),a.addClass("success-resend-confirmation"),$("#helpModal").modal("hide")):(a.removeClass("resending-confirmation"),Toasts.parseMessages(Api.parseServerErrorMessage(t),"danger"))},function(t){a.removeClass("resending-confirmation"),e.prop("disabled",!1),$("#helpModal").modal("hide"),Utils.refresh()})}function initConfirmationOkModal(){urlParams.confirmed&&(Utils.wrap(".handlebar-facebook-info",{facebook:null}),Utils.wrap(".handlebar-confirmation-ok",{from:Str.get(urlParams.confirmed?"registration-from-join":"registration-from-create")}),$("#confirmationOkModal").modal("show"))}function initSmoothScrollControls(){var t=location.hash;Utils.smoothScroll(t),$(document).on("click",".smooth-scroll",function(t){Utils.smoothScroll(t.currentTarget.hash)})}function initDisableOn(){$(document).on("click","[data-disable-on]",function(t){var e=$(t.currentTarget),a=e.attr("data-disable-on");return!$(document).has(a).length||(t.preventDefault(),!1)})}function modalFacebookConnect(){if(!FBManager._initialized)return void FBManager.init(modalFacebookConnect);Utils.facebookConnect(function(t){Log.info("modalFacebookConnect success:",t)},Utils.onResponse("#confirmationOkModal"))}function modalFacebookDisconnect(){if(!FBManager._initialized)return void FBManager.init(modalFacebookDisconnect);Utils.facebookDisconnect(function(t){Utils.wrap(".handlebar-facebook-info",{}),Log.info("modalFacebookDisconnect success:",t)},Utils.onResponse("#confirmationOkModal"))}function initGlobalMenu(){Log.info("main.js::initSwiper ... "+$(".swiper-container").length);var t,e=(__.g("li").role,$("#globalMenuModal"));e.on("shown.bs.modal",function(a){var n=$(a.relatedTarget).attr("data-tab");if(e.is("initialized"));else{e.addClass("initialized");$("#globalMenuModal .tab-pane:visible");t=new Swiper(".swiper-container",{pagination:".swiper-pagination",spaceBetween:20,grabCursor:!0,onInit:function(t){Log.info("main.js::initSwiper ... SWIPER INITIALIZED.")},onSlideChangeStart:function(t){Log.info("main.js::initSwiper ... SLIDE CHANGED...");t.snapIndex;$(".global-menu-tabs li:eq("+t.snapIndex+") a").tab("show")}}),$('.global-menu-tabs a[data-toggle="tab"]').on("show.bs.tab",function(e){e.target,e.relatedTarget;var a=$(e.target).closest("li").index();t.slideTo(a)})}e.find(".global-menu-tabs > li.active").removeClass("active"),e.find(".global-menu-tabs > li:eq("+(n||0)+")").addClass("active"),t.slideTo(n||1),t.update()})}function initRanks(){Log.info("main.js::initRanks ... "),$(document).on("click",".smart-table .sortable[data-key]",function(t){var e=$(t.currentTarget);e.toggleClass("asc");var a=e.attr("data-key"),n=e.is('.cell-date, .cell-index, [class*="digit"], [data-sort-type="number"]')?"number":"text",i=e.is(".asc"),o=e.closest(".smart-table");o.is(".locked")||(sortTable(o,a,i,n||"number"),e.addClass("sort-criteria"))})}function _getRoleIndex(t){return(t.match(_MANTRA_ROLE_SPLITTER)||[]).map(function(t){return _ROLE_INDEX[String(t).toLowerCase()]}).join("-")}function sortTable(t,e,a,n){t.find(".sort-criteria").removeClass("sort-criteria");var i=e,o=t.find('tbody tr:has([data-key="'+i+'"])').each(function(){var t=$(this).find('[data-key="'+i+'"]'),e="role"==i?_getRoleIndex(t.text()):t.text();$(this).attr("data-sort",t.attr("data-sort-value")||e)});t.is(".paginated")?Paginator.sortBy(i,a,"text"==n):(o.sort(function(t,e){return"text"==n?t.getAttribute("data-sort").localeCompare(e.getAttribute("data-sort")):Utils.parseFloat(e.getAttribute("data-sort"))-Utils.parseFloat(t.getAttribute("data-sort"))}),o.parent().first().prepend(a?o:o.get().reverse()),o.find('[data-key="'+i+'"]').addClass("sort-criteria"))}function initFilters(t){$(".filter[data-target].dropdown .dropdown-menu [data-key]").click(function(t){var e=$(t.currentTarget),a=e.closest(".dropdown"),n=e.attr("data-key");a.attr("data-current-selection",n),a.find(".dropdown-selection").text(e.text());var i=$(a.attr("data-target"));i.length&&sortTable(i,n,!0,"text")});var e;$(".filter[data-target] .search").on("change keydown",function(t,a){var n=a&&a.preventUpdate,i=$(t.currentTarget);clearTimeout(e);var o=i.closest("[data-target]"),r=$(o.attr("data-target"));e=setTimeout(function(){filterTable(r,i.val(),n?+o.attr("data-page"):1,+o.attr("data-per-page"),n,o.attr("data-row-selector")||"")},200),$("").on("click",function(t){console.log("---> main.js stange function...");var e=$(t.currentTarget);e.attr("data-sort-by")})})}function filterTable(t,e,a,n,i,o){Log.info("main.js::filterTable - preventUpdate:"+i),t.find(".match").removeClass("match");var r=t.find("tbody tr"+o);r.removeClass("filtered odd even");var s=a?(a-1)*(n||r.length):0,l=a?s+(n||r.length):void 0,c=t.find("tbody tr"+o+':contains("'+e+'")');t.toggleClass("no-matches",!c.length);var d=c.slice(s,l);d.filter(":odd").addClass("odd"),Log.info("main.js::filterTable selector: "+o),Log.info("main.js::filterTable - start:"+s+" --- end: "+l+" $matches: "+d.length+" ... totals: "+c.length),r.not(d).addClass("filtered"),e.length>0&&d.find('td:not(:has(select)):contains("'+e+'"), td:has(option:selected:contains("'+e+'"))').addClass("match"),i||$(document).trigger("fg.filters.update",{totals:c.length})}function updateFiltersPage(t,e){Log.info("main.js::updateFiltersPage - page:"+t),$(".filter[data-page], .filter [data-page]").attr("data-page",t),$(".filter[data-page] .search, .filter [data-page] .search").trigger("change",{preventUpdate:e})}function initCheckboxToggle(){var t=function(t){var e=$(t.currentTarget||this),a=$(e.attr("data-check-toggle-target"));if(a.length){var n=e.attr("data-check-toggle-class");a.toggleClass(n||"checked",e.prop("checked"))}};$(document).on("change","input[data-check-toggle-target]",t),$("input[data-check-toggle-target]").each(t)}var forceMin=!0;$.material.options.checkboxElements="input[type=checkbox]:not(.native)";var Globals={LT:0==__.g("sd").gameType?38:27,tip:__.g("sd").gameTip,realLeagueLabel:0==__.g("sd").gameType?"Serie A":"EuroCalendario",_userInitialized:!1,_leaguesHash:{},userInfo:null,storeCredentials:!1,facebookInfo:null,userSocials:{},isIos:/iPhone|iPad|iPod|Macintosh/i.test(navigator.userAgent),isMobile:/iPhone|iPad|iPod|Android/i.test(navigator.userAgent),isWebView:!1,ignorePageUnload:!1,serverTimeOffset:0,manageLoading:function(t,e){var a=$(document.activeElement);a&&a.prop("disabled",!0);var n=t instanceof $?t:$(t);n.addClass("loading-box loading"),e.always(function(){a&&a.prop("disabled",!1),n.removeClass("loading")})},autoLogin:function(t){t=t||Globals.getUserId(),Log.info("main.js::initLogin - Tentativo di auto login con user id: "+t),$("body").addClass("logging"),Api.loginById(t,Globals.onLoginSuccess,Globals.onLoginFail).done(function(t){$("body").removeClass("logging")})},logout:function(t){Log.info("Globals::logout..."),t||Utils.showLoading(),$("body").addClass("waiting-for-login").removeClass("logged"),$("body").addClass("logging"),Api.logout(function(e){Globals.onLogout(t)},function(e){if(!e.success&&e.error_msgs&&e.error_msgs[0]&&"KK01"==e.error_msgs[0].id)return void Globals.onLogout(t);if(!t){Utils.hideLoading();var a=Api.parseServerErrorMessage(e);Toasts.parseMessages(a)}Log.error("main.js::logout - error response:",e)}).done(function(t){$("body").removeClass("logging")})},onLogout:function(t){t||Utils.hideLoading(),delete Globals.userInfo,delete Globals.facebookInfo,LocalStorage.set("userInfo",null),t||Utils.redirect(MyLeague.getUrl()||"/"),$(document).trigger("fg.user.unlogged")},updateUserInfo:function(t,e){Log.info("main.js::updateUserInfo - login data: ",t),Globals.userInfo=t,LocalStorage.set("userInfo",t),t.data.leghe&&t.data.leghe.length&&(t.data.leghe=t.data.leghe.sort(function(t,e){return(t.visibile?t.ordine:1/0)-(e.visibile?e.ordine:1/0)}),t.data.leghe.map(function(t){Globals._leaguesHash[t.alias]=t})),t.data.utente.initials=Utils.getInitials(t.data.utente.username),Globals.userSocials={},t.data.utente.social&&t.data.utente.social.map(Globals.updateUserSocial);var a=__.g("li");if(a){var n=!!Globals.getUserLeague(a.alias);$("body.leagues").toggleClass("league-member",n).toggleClass("guest",!n).toggleClass("league-admin",Globals.isAdmin()).toggleClass("league-main-admin",Globals.isMainAdmin()).toggleClass("live",a.live)}if(e||(Utils.wrap("#userInfoTemplate",t.data),Utils.wrap(".handlebar-user-info",t.data),Utils.wrap(".leagues-template",t.data),$("body").addClass("logged").toggleClass("waiting-confirmation",0==t.data.utente.confermato)),!Globals._userInitialized){Globals._userInitialized=!0;var i=$(".competition-current[data-id]").attr("data-id"),o=Utils.parseBool($('[data-isin][data-id="'+i+'"]').attr("data-isin"));$("body").toggleClass("is-in-competition",o),$("body").toggleClass("not-is-in-competition",!o),$(document).trigger("fg.user.inititalized"),$("body").addClass("user-initialized")}$(document).trigger("fg.user.update")},updateUserSocial:function(t,e){Globals.userSocials[e||t.provider]=t},getUserSocial:function(t){return t?Globals.userSocials[t]:Globals.userSocials},removeUserSocial:function(t){"facebook"==t&&delete Globals.facebookInfo,Globals.updateUserSocial(null,t)},isLogged:function(){return Boolean(Globals.userInfo&&Globals.userInfo.data&&Globals.userInfo.data.utente&&Globals.userInfo.data.utente.id)},isMainAdmin:function(){return 0==__.g("li").role},isAdmin:function(){return 0==__.g("li").role||1==__.g("li").role},getUserId:function(){return Globals.isLogged()?Globals.userInfo.data.utente.id:null},getUserData:function(){return Globals.isLogged()?Globals.userInfo.data.utente:null},getUserLeague:function(t){return Globals.isLogged()?Globals._leaguesHash[t]:null},isConfirmed:function(){return Globals.userInfo&&Globals.userInfo.data&&Globals.userInfo.data.utente&&1==Globals.userInfo.data.utente.confermato},getCurrentLeagueInfo:function(){return __.g("li")},getLeagueAlias:function(){return Globals.getCurrentLeagueInfo().alias},getLeagueUrl:function(){return Settings.baseUrl+Globals.getLeagueAlias()+"/"},getTeamInfoById:function(t){return __.g("lt",t)},onChangeRangesDefault:function(t,e){return Globals._onChangeRangesDefault(t,e,!1)},onChangeRangesInverse:function(t,e){return Globals._onChangeRangesDefault(t,e,!0)},_onChangeRangesDefault:function(t,e,a){if(t){var n=$(t).closest(".range-cell"),i=t.name,o=Utils.parseFloat(t.value);n[a?"nextAll":"prevAll"]().find('input[name="'+i+'"]').val(function(t,e){var a=Utils.parseFloat(e);return a>o?o:a}),n[a?"prevAll":"nextAll"]().find('input[name="'+i+'"]').val(function(t,e){var a=Utils.parseFloat(e);return a<o?o:a})}}},Leagues={TYPES:{1:"Classic",2:"Mantra"},getCurrent:function(){return __.g("li")}},MyUser={_info:__.g("u"),getInfo:function(){return this._info&&this._info.utente},isLogged:function(){return Boolean(this.getInfo())},coachType:__.g("li").coachType,isAdmin:function(){return this.isLogged()&&(0==__.g("li").role||1==__.g("li").role)},isMainAdmin:function(){return this.isLogged()&&0==__.g("li").role},isMainCoach:function(){return this.isLogged()&&0==this.coachType},isAssistant:function(){return this.isLogged()&&1==this.coachType},getNickname:function(){return this.isMainCoach()?MyTeam.getMainCoach():MyTeam.getAssistant()},isInCurrentLeague:function(){return this.isLogged()&&this.coachType!=-1}},MyTeam={_rosterState:null,_rosterSlots:null,_roster:null,getId:function(){return __.g("li").teamId},get:function(){var t=__.g("lt",MyTeam.getId());return t.id?t:{id:MyTeam.getId()}},isInCurrentCompetition:function(){return __.g("li").inCompetition},getName:function(){return MyTeam.get().nome},getCrest:function(){return Settings.crestsBaseUrl+MyTeam.get().logo},getMainCoach:function(){return __.g("li").mainCoach},getAssistant:function(){return __.g("li").assistantCoach},_profileProgress:__.g("li").progress&&__.g("li").progress.split(";")||[0],getProfileProgress:function(){return Math.floor(this._profileProgress.filter(function(t){return 1==t}).length/this._profileProgress.length*100)},setRoster:function(t){MyTeam.updateRosterCosts(),MyTeam._roster=t},getRoster:function(){return MyTeam._roster||MyTeam.setRoster(Rosters.getMyRoster()),MyTeam._roster||Log.error("MyTeam - _roster not set!"),MyTeam._roster},updateRosterCosts:function(){var t=MyTeam.get();if(t.calciatori){var e=t.costi.split(";");t.calciatori.split(";").map(function(t,a){var n=Rosters.getPlayerById(t);n&&(n.cost=e[a])})}},setRosterState:function(t){MyTeam._rosterState=t},setRosterSlots:function(t){MyTeam._rosterSlots=t},checkPurchases:function(){return MyTeam._rosterState.unlimited||MyTeam._rosterState.avPurchases>0},checkCredits:function(t,e){return MyTeam._rosterState.budget+(+e||0)>=(t||0)},checkRosterSpaceByRole:function(t){return MyTeam._rosterSlots.hash[t].free>0},checkRosterSpace:function(t,e){return!(!e||t!=e)||MyTeam._rosterSlots.rosterFreeSpace>0&&(!t||MyTeam.checkRosterSpaceByRole(t))},getEditModalHeader:function(){return{customClass:"cur-team-header",customTitleClass:"cur-team-name",customImageClass:"cur-team-logo",image:MyTeam.getCrest(),title:MyTeam.getName(),subtitile:MyLeague.getName()}}},MyLeague={_info:__.g("li"),_adminsHash:{},_init:function(){$(".fg").toggleClass("league-mantra",MyLeague.isMantra()),$.isArray(MyLeague._info&&MyLeague._admins)&&MyLeague._info._admins.map(function(t){MyLeague._adminsHash[t.id]=t})},get:function(){return MyLeague._info},isEuro:function(){return 1==__.g("sd").gameType},isMantra:function(){return 2==MyLeague._info.type},getRoles:function(){return MyLeague.isMantra()?"Por Ds Dc Dd E M C W T A Pc".split(" "):"p d c a".split(" ")},getRoleGroups:function(){return MyLeague.isMantra()?"por gm".split(" "):"p d c a".split(" ")},getCurrentTurn:function(){if(!isNaN(parseInt(MyLeague._info.currentTurn)))return MyLeague._info.currentTurn;alert("TURNO CORRENTE NON DISPONIBILE")},getName:function(){return MyLeague._info.name},getAlias:function(){return MyLeague._info.alias},getUrl:function(){return MyLeague._info&&MyLeague._info.alias?Settings.baseUrl+MyLeague._info.alias+"/":null},getTeamById:function(t){return __.g("lt",t)},getTeams:function(){return __.g("lt")},getCompetitions:function(){return __.g("c")},getCompetitionById:function(t){return __.g("c",t)},getCurrentCompetitionId:function(){return MyLeague._info.competitionId},getAdminById:function(t){return MyLeague._adminsHash[t]},getCountdownMillis:function(){return 1e3*(+MyLeague._info.countdown||0)}};MyLeague._init();var Teams={_list:__.g("lt"),getById:function(t){return __.g("lt",t)}},Match={iconSrcBaseUrl:"match/",getIconSrc:function(t){var e=Settings.imageBaseUrl+Match.iconSrcBaseUrl;switch(String(t).toLowerCase()){case"1":case"amm":e+="amm";break;case"5":case"ass":e+="assist";break;case"6":case"asf":e+="assistf";break;case"10":case"aut":e+="autogol";break;case"0":case"in":e+="entrato";break;case"2":case"esp":e+="esp";break;case"3":case"gol":e+="golfatto";break;case"12":case"gp":e+="golpareggio";break;case"4":case"gs":e+="golsubito";break;case"11":case"gv":e+="golvittoria";break;case"0":case"migliore":e+="migliore";break;case"13":case"imb":e+="portiereimbattuto";break;case"7":case"rig_pa":e+="rigoreparato";break;case"8":case"rig_sb":e+="rigoresbagliato";break;case"9":case"rig":e+="rigoresegnato";break;case"0":case"sp":e+="spostato";break;case"0":case"out":e+="uscito";break;default:return null}return e+".png"},getIconTooltip:function(t){switch(String(t).toLowerCase()){case"1":case"amm":return"Ammonizione";case"5":case"ass":return"Assist";case"6":case"asf":return"Assist da fermo";case"10":case"aut":return"Autogol";case"0":case"in":return"Subentrato dalla panchina";case"2":case"esp":return"Espulso";case"3":case"gol":return"Gol segnato";case"12":case"gp":return"Gol del pareggio";case"4":case"gs":return"Gol subito";case"11":case"gv":return"Gol della vittoria";case"0":case"migliore":return"Migliore in campo";case"13":case"imb":return"Porta imbattuta";case"7":case"rig_pa":return"Rigore parato";case"8":case"rig_sb":return"Rigore sbagliato";case"9":case"rig":return"Rigore segnato";case"0":case"sp":return"Spostato";case"0":case"out":return"Sostituito";default:return""}},getIconConfig:function(t){return{tooltip:Match.getIconTooltip(t),src:Match.getIconSrc(t)}},parseExtratime:function(t,e){if(!t)return!1;var a=t.split("|");if(!a||2==!a.length)return!1;var n=a[0],i=e.split("-"),o="t"==a[1].toLowerCase()?[0,0]:n.split("-");return{regular:e,overtime:"s"==a[1].toLowerCase()&&n,penalties:"r"==a[1].toLowerCase()&&n,forfait:"t"==a[1].toLowerCase()&&n,final:Number(i[0])+Number(o[0])+"-"+(Number(i[1])+Number(o[1]))}}},UI={initServerMessages:function(){$(document).on("click",'[data-dismisser=".alert"]',function(t){var e=$(t.currentTarget).closest(".server-messages");e.attr("data-messages",e.find(".server-messages").length)})},initImgManager:function(){},initDisableCurrentLinks:function(){$(".disable-if-current[href]").attr("href",function(t,e){return e==location.href?($(this).addClass("disabled"),"javascript:void();"):e})},_tooltipInitialized:!1,initTooltips:function(){$('[data-toggle="tooltip"]:not(.tooltip-init)').on("touchend click",function(t){$(t.currentTarget).tooltip("toggle")}),$('[data-toggle="tooltip"]:not(.tooltip-init)').addClass("tooltip-init").each(function(t,e){$(e).tooltip({animation:!0,container:e.getAttribute("data-container")||"body > .viewport"})}),$('[data-toggle="tooltip"].tooltip-init').tooltip("fixTitle"),UI._tooltipInitialized||(UI._tooltipInitialized=!0,$(document).on("mouseleave",'[data-toggle="tooltip"]',function(t){$(t.currentTarget).tooltip("hide")}))},initPopovers:function(){$('[data-toggle="popover"]:not(.popover-init)').addClass("popover-init").popover(),$(document).off("click",".popover .autoclose").on("click",".popover .autoclose",function(t){$(t.currentTarget).closest(".popover").popover("hide")})},initToggles:function(){$(".toggle-status").not(":has(.toggle)").find('[type="checkbox"]').after('<div class="toggle"></div>'),UI.initToggleStatus()},initToggleStatus:function(){$(".toggle-status .toggle").attr("data-on",function(){return $(this).closest(".toggle-status").attr("data-on")||"attiva"}).attr("data-off",function(){return $(this).closest(".toggle-status").attr("data-off")||"disattiva"})},initDateTimePickers:function(){if($.DateTimePicker){var t=new Date(Date.now()+Globals.serverTimeOffset+6e4),e=$("[data-toggle='date-time-picker']:not('.date-time-picker-init')").first();e.DateTimePicker({dateTimeFormat:"dd-MM-yyyy HH:mm",clearButtonContent:"Esci",setButtonContent:"Ok",language:"it",minDateTime:t}),e.addClass("date-time-picker-init")}},initDataPicker:function(){$(document).on("focus","input[data-picker]:not(.locked)",function(t){var e=$(t.currentTarget),a=Utils.ifExists(+e.attr("min"),-(1/0)),n=Utils.ifExists(+e.attr("max"),1/0),i=e.closest(".range-cell"),o=e.closest(".range-col").find("input[data-picker]"),r=i.prevAll().has("input[readonly]").first().find("input"),s=o.index(r),l=s>=0?+r.val():0,c=i.nextAll().has("input[readonly]").last().find("input"),d=o.index(c),u=d>=0?+c.val():999,g=(d>=0&&o.length,o.index(e)-s-1),f=n-u,p=+e.val(),h=$("#editModal #"+e.attr("data-picker")).closest(".toggle-picker"),m=h.addClass("active").find("input");m.prop("checked",function(){return p==this.value}),m.each(function(t,e){var i=t+1<a||t<l+g||t+1>n;f>=0&&(i=i||t+u-p+1>n),$(e).prop("disabled",i).prop("readonly",i),$(e).closest("label").toggleClass("disabled",i)});var v=h.find("label");v.on("click",function(t){var a=$(t.currentTarget);if(!a.is(".disabled")){var n=a.find("input").val();n>0&&(e.attr("data-old-value",e.val()),e.val(n),e.trigger("change"))}h.removeClass("active"),e=null,v.off("click")}),h.find(".form-group").click(function(t){$(t.target).is(".form-group")&&(h.removeClass("active"),e=null,v.off("click"))})})},initMultiselects:function(){$(document).on("mousedown","select[multiple] option",function(t){return t.preventDefault(),$(this).prop("selected",!$(this).prop("selected")).attr("selected",function(){return this.selected?"selected":null}),!1}),$(document).on("change",".checklist-group .checklist-search",function(t){var e=t.currentTarget&&t.currentTarget.value;$(".checkbox-list > *").each(function(t,a){var n=$(a);n.toggle(!e||n.is(':contains("'+e+'")'))})}),$(document).on("keyup",".checklist-group .checklist-search",function(t){$(t.currentTarget).trigger("change")}),$(document).on("change",".checklist-group input.checklist-select-all[type=checkbox]",function(t){var e=t.currentTarget.checked,a=$(t.currentTarget).closest(".form-group"),n=a.find(".checkbox-list");n.find("input[type=checkbox]").each(function(t,a){a.checked=e});var i=a.find(".control-label");i.attr("data-selecteds",n.find(":checked").length),i.attr("data-unselecteds",n.find('input[type="checkbox"]:not(:checked)').length),n.find(".check-list-item-value input").prop("disabled",!e)}),[".check-list",".checkbox-list"].map(function(t){$(document).off("click",t+"[data-min] label:has(input), "+t+"[data-max] label:has(input)").on("click",t+"[data-min] label:has(input), "+t+"[data-max] label:has(input)",function(e){Log.info("main.js::check-list click...");var a=$(e.currentTarget).find("input"),n=a.closest(t),i=n.find(":checked"),o=+n.attr("data-min")||0,r=+n.attr("data-max")||1/0,s=a.prop("checked"),l=!!n.attr("data-range"),c=(n.attr("data-lock")||"").split(/\s*,\s*/g);if(l&&c.length){var d=Utils.thereIs(c,"min"),u=Utils.thereIs(c,"max"),g=n.find("input"),f=g.index(i.not(a).first()),p=g.index(i.not(a).last()),h=g.index(a),m=Math.abs(h-f)<Math.abs(h-p);if(m&&d||!m&&u)return e.preventDefault(),!1}return n.is(".readonly")||s&&i.length<=o||a.is("[readonly]")?(e.preventDefault(),!1):(!s&&i.length>=r&&i.not(a).slice(-i.length+r).prop("checked",!1),a[0].checked=!s,a.prop("checked",!s),!0)}),$(document).off("change",t+" input, "+t+" input").on("change",t+" input, "+t+" input",function(e){var a=$(e.target),n=a.closest(t);e.target.id&&$("#"+e.target.id+"_val").prop("disabled",!e.target.checked),setTimeout(function(){var t=a.closest(".form-group").find(".control-label");t.attr("data-selecteds",n.find(":checked").length),t.attr("data-unselecteds",n.find('input[type="checkbox"]:not(:checked)').length)},1)}),$(document).off("change",t+"[data-min] input, "+t+"[data-max] input").on("change",t+"[data-min] input, "+t+"[data-max] input",function(e){var a=$(e.target),n=a.closest(t),i=n.find(":checked"),o=(n.attr("data-min"),n.attr("data-max"),!!n.attr("data-range")),r=a.prop("checked");if(o&&i.length>1){var s=n.find("input"),l=s.index(i.not(a).first()),c=s.index(i.not(a).last()),d=s.index(a);r?(d<l&&s.slice(d,l).prop("checked",!0),d>c&&s.slice(c,d).prop("checked",!0)):(l-d>d-c?s.slice(l,d).prop("checked",!1):s.slice(d,c+1).prop("checked",!1),a.prop("checked",!0))}}),$(document).off("mousemove",t+"[data-range]").on("mousemove",t+"[data-range]",function(t){var e=$(t.currentTarget),a=+e.attr("data-min")||0,n=+e.attr("data-max")||1/0,i=(e.attr("data-lock")||"").split(/\s*,\s*/g),o=Utils.thereIs(i,"min"),r=Utils.thereIs(i,"max"),s=e.find(":has(:checked):first, :has(:checked):last"),l=!1;t.buttons&&!s.length&&(l=!0,s=e.find(":has(input:hover)"),s.find("input").prop("checked",!0));var c={top:t.clientY,left:t.clientX},d=s.closestToOffset(c);if(d){var u;if(t.buttons&&!l||($(".ranged").removeClass("ranged"),d.addClass("ranged"),u=e.children().index(d),e.attr("data-drag-index",u)),e.find("label").removeClass("range-first range-last"),e.find("label:has(:checked)").first().addClass("range-first"),e.find("label:has(:checked)").last().addClass("range-last"),t.buttons){var g=e.attr("data-drag-index");if(g){var f=e.find("input"),p=e.children().closestToOffset(c),h=e.find(":checked"),m=f.index(h.first()),v=f.index(h.last()),b=Math.min(Math.max(e.children().index(p),a-1),n-1);Log.info("min: "+a+" | first: "+m+" | last: "+v+" | current: "+b+" | dragIndex: "+g),g==m&&m!=v?b<=v&&!o&&(b<g&&($slice=f.slice(b,g).prop("checked",!0),e.attr("data-drag-index",b)),b>g&&($slice=f.slice(g,b).prop("checked",!1),e.attr("data-drag-index",b))):g==v&&m!=v?b>=m&&!r&&(Log.info("dragging last range limit: "+g),b<g&&(f.slice(b+1,v+1).prop("checked",!1),e.attr("data-drag-index",b)),b>=g&&(f.slice(g,b+1).prop("checked",!0),e.attr("data-drag-index",b))):m==v&&(Log.info("creating range drag: "+g),b>=g&&!r&&(f.slice(g,b+1).prop("checked",!0),e.attr("data-drag-index",b)),b<g&&!o&&(f.slice(b,g).prop("checked",!0),e.attr("data-drag-index",b)))}}}})})},initAutoTrim:function(){$(document).on("blur","input[autotrim]",function(){this.value=this.value.trim()})},initChosen:function(){$().chosen&&$(".chosen-select:not(.inititalized)").each(function(){var t=$(this);t.addClass("inititalized");var e=+t.attr("data-max"),a={disable_search_threshold:10};e>0&&(a.max_selected_options=e),t.chosen(a).change(UI._onChosenChange);var n=t.val();for(var i in n){var o={selected:n[i]};UI._onChosenChange({currentTarget:t},o,!0)}})},_onChosenChange:function(t,e,a){var n=$(t.currentTarget),i=n.attr("data-group");if(i)for(var o in e){var r=$('select.chosen-select[data-group="'+i+'"]');r.find('option[value="'+e[o]+'"]:not(:selected)').prop("disabled","selected"==o),a||r.trigger("chosen:updated")}var s=+n.attr("data-min"),l=+n.attr("data-max");l>0&&(n.toggleClass("max-selection-reached",n.val().length>=l),n.toggleClass("error-max",n.val().length>s)),isNaN(s)||(n.toggleClass("min-selection-reached",n.val().length==s),n.toggleClass("error-min",n.val().length<s))},autoSelectChosen:function(t){var e=$("[data-id="+t+"]"),a=e.find("select.chosen-select"),n=0;for(a.trigger("chosen:updated"),a=a.filter(".error-max");a.length&&n++<100;){var i=a.first(),o=i.find("option:selected"),r=Math.floor(Math.random()*o.length),s=o.eq(r);s.prop("selected",!1);var l={deselected:s.attr("value")};UI._onChosenChange({currentTarget:i},l,!0),i.trigger("chosen:updated"),a=a.filter(".error-max")}for(a=e.find("select.chosen-select:not(.max-selection-reached)");a.length&&n++<100;){var i=a.first(),o=i.find("option:not(:selected):not(:disabled)"),r=Math.floor(Math.random()*o.length),s=o.eq(r);s.prop("selected",!0);var l={selected:s.attr("value")};UI._onChosenChange({currentTarget:i},l,!0),i.trigger("chosen:updated"),a=a.not(".max-selection-reached")}},initDismisser:function(){$(document).on("click","[data-dismisser]",function(t){var e=$(t.currentTarget),a=e.closest(e.attr("data-dismisser"));a.one("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend",function(t){a.remove()}),a.addClass("removing")})},initColorPickers:function(){$.spectrum&&$("[data-toggle='color-picker']:not(.initialized)").addClass("initialized").spectrum({chooseText:"OK",cancelText:"ANNULLA",showButtons:!1,showPalette:!0,showPaletteOnly:!0,togglePaletteOnly:!1,showSelectionPalette:!1,
palette:[[].concat(["#E68890","#DF6671","#D94452","#C63E4B","#B23844","#9E323C","#77262D"],["#FCE8DB","#FFD5A2","#FFBD7B","#FFA645","#FF8B00","#E48538","#B66B2D"],["#FFF9D9","#FFEDB3","#FFE98A","#FCD700","#E7B100","#D09F00","#8B6A00"],["#CCE2B3","#B4D692","#94C563","#7EAF4D","#749939","#587b36","#4C692E"],["#AEE3D7","#6CCDB6","#35BB9B","#2C9A7F","#278971"],["#DCF7F9","#B8E8F2","#6FC3E3","#4BB4DC","#359EC6","#2B7E9E","#205F77"],["#DAE8F7","#C3D7F2","#81AFE2","#5B93DD","#1871C0","#30588B","#233F64"],["#E2DAF4","#CFC2EE","#BCAAE7","#A791E0","#896FC7","#6E599F","#524377"],["#EFCBE3","#E4A4CA","#DD8ABB","#D670AC","#BF4797","#8E1B6E","#560A44"],["#FFFFFF","#EDEFF1","#D9DCE2","#B9BEC5","#94989E","#757A81","#535962","#3C434C","#000000"])],change:function(t){},hide:function(t){},move:function(t){$(this).trigger("change")}})},initSameForAllCheck:function(){var t=function(t){var e=$(t),a=e.attr("data-same-for-all"),n=$('[id*="'+a+'."]'),i=t.checked,o=n.first();n.not(o).prop("readonly",i),i?(n.not(o).val(o.val()),o.on("change keyup",function(){var t=o.val();t=parseFloat(String(t).replace(",","."),10),t=isNaN(Number(t))?0:Number(t),n.not(o).val(t)})):o.off("change keyup")};$("[data-same-for-all]").each(function(){var e=$(this),a=e.attr("data-same-for-all"),n=$('[id*="'+a+'."]'),i=!!n.map(function(){return this.value}).get().reduce(function(t,e){return t===e?t:NaN});e.prop("checked",i),e.prop("readonly",i),t(this)}).change(function(e){t(e.currentTarget)})},initCounters:function(){$('[data-control="counter"]:not(".control-counter"), [data-control="minmax"]:not(".control-counter")').each(function(){var t=this,e=$(this),a=+parseFloat(e.attr("data-step"),10)||1;e.addClass("control-counter"),$('<span class="input-group-addon counter-next">+</span>').insertAfter(e).click(function(){var n=+t.value,i=e.attr("max");Utils.isUndefined(i)?(t.value=n+a,e.trigger("change")):($.isNumeric(i)||(i=+$(Utils.escapeKey(i)).val()),n+a<=i&&(t.value=n+a,e.trigger("change")))}),$('<span class="input-group-addon counter-prev">-</span>').insertBefore(e).click(function(){var n=+t.value,i=e.attr("min");Utils.isUndefined(i)?t.value=n-a:($.isNumeric(i)||(i=+$(Utils.escapeKey(i)).val()),n-a>=i&&(t.value=n-a,e.trigger("change"))),e.trigger("change")})})},_coutndownTimeoutId:null,initCountdowns:function(){var t=Date.now(),e=!1;$("[data-countdown]").each(function(a,n){var i=$(n),o=null;try{o=JSON.parse(i.attr("data-countdown"))}catch(t){Log.error("main.js::initCountdowns - data-countdown config error ")}if(o&&o.end){var r=Math.max(Number(o.end)-t,0)-(o.timeOffset||0);i.text(Utils.formatCountdown(r,o.format||"hh:mm:ss"))}r>0&&(e=!0)}),$("body").toggleClass("countdown-active",e),e&&(clearTimeout(this._coutndownTimeoutId),this._coutndownTimeoutId=setTimeout(UI.initCountdowns,1100-t%1e3))},initInputPattern:function(){$(document).on("change","[data-pattern]",function(t){var e=t.currentTarget,a=new RegExp(e.getAttribute("data-pattern"));return e.value.match(a)?(e.setAttribute("data-old-value",e.value),!0):(e.value=e.getAttribute("data-old-value")||e.defaultValue||"",!1)}),$(document).on("keyup","[data-pattern]",function(t){$(t.currentTarget).trigger("change")})},initRestricts:function(){$("[data-restrict]:not(.restricted)").each(function(){var t=$(this);t.addClass("restricted");var e=new RegExp(t.attr("data-restrict"));t.on("keydown",function(t){return Boolean(t.key.match(e))})})},initInputPoints:function(){$("body").on("change","input.input-points",function(t){var e=this;e.value=.5*Math.round(e.value/.5)})},initEditables:function(){$("[data-editable]:not(.editable)").each(function(){var t=$(this);t.addClass("editable");var e=t.find("[data-editable-target]");e.text()})},initSortableList:function(){var t=function(t,e){$(t.target).find(".sortable-item").attr("data-index",function(t){return t+1})};$(".sortable-list").sortable({axis:"y",items:"> .sortable-item:not(.locked)",create:t,stop:t})},initSliders:function(){var t=$('.slider:not(".slider-initialized")');window.noUiSlider&&t.addClass("slider-initialized").each(function(t,e){var a=+e.getAttribute("data-min"),n=+e.getAttribute("data-max"),i=+Utils.ifExists(e.getAttribute("data-min-lock"),a),o=+Utils.ifExists(e.getAttribute("data-max-lock"),n);o<i&&(o=i);var r=+e.getAttribute("data-lower"),s=+e.getAttribute("data-higher"),l=e.getAttribute("data-lower-label"),c=e.getAttribute("data-higher-label"),d=e.getAttribute("data-lower-input"),u=e.getAttribute("data-higher-input");noUiSlider.create(e,{start:[r,s],connect:!0,step:1,range:{min:a,max:n}});var g=[$(l),$(c)],f=[$(d),$(u)];e.noUiSlider.on("update",function(t,a){return 0==a&&t[a]<i?void e.noUiSlider.set([i,null]):1==a&&t[a]>o?void e.noUiSlider.set([null,o]):(g[a]&&g[a].text(Math.floor(t[a])),void(f[a]&&f[a].val(Math.floor(t[a])).trigger("change")))})})},initSelectPicker:function(){$.fn.selectpicker&&($(".bootstrap-select:not(:has(select))").remove(),$(".selectpicker:not(.selectpicker-initialized)").addClass("selectpicker-initialized").selectpicker())},_lazyUid:1,_lazyScrollHash:{},_lazyScrollUpdate:null,_lazyScrollUpdateComplete:null,_lazyNoMoreUpdate:!1,_lazyChunkSize:10,initLazyLoad:function(){$("[data-lazy-load]").each(function(){var t=$(this),e=t.find(t.attr("data-lazy-load"));if(UI._lazyScrollUpdate=window[t.attr("data-lazy-load-update")],UI._lazyChunkSize=+t.attr("data-lazy-load-chunk-size")||10,e.length){var a=$(t.attr("data-lazy-load-viewport")||".viewport"),n=t.attr("data-lazy-uid");Log.info("initLazyLoad... uid:"+n),n||(n=UI._lazyUid,t.attr("data-lazy-uid",UI._lazyUid),UI._lazyUid++),UI._lazyScrollHash[n]||(UI._lazyScrollHash[n]=UI.getNewLazyScrollListener()),a.off("scroll",UI._lazyScrollHash[n]).on("scroll",e,UI._lazyScrollHash[n]),a.off("shown.bs.modal editmodal.changing.end",UI._lazyScrollHash[n]).on("shown.bs.modal editmodal.changing.end",e,UI._lazyScrollHash[n]),UI._lazyScrollHash[n](null,e,a[0])}})},_initLazyLoad:function(){console.time("initLazyLoad"),__.qsa("[data-lazy-load]").forEach(function(t){console.time("initLazyLoad > EACH");var e=t.querySelectorAll(t.getAttribute("data-lazy-load"));if(UI._lazyScrollUpdate=window[t.getAttribute("data-lazy-load-update")],UI._lazyChunkSize=+t.getAttribute("data-lazy-load-chunk-size")||10,e.length){var a=$(t.getAttribute("data-lazy-load-viewport")||".viewport"),n=t.getAttribute("data-lazy-uid");Log.info("initLazyLoad... uid:"+n),n||(n=UI._lazyUid,t.getAttribute("data-lazy-uid",UI._lazyUid),UI._lazyUid++),UI._lazyScrollHash[n]||(UI._lazyScrollHash[n]=UI.getNewLazyScrollListener()),a.off("scroll",UI._lazyScrollHash[n]).on("scroll",e,UI._lazyScrollHash[n]),a.off("shown.bs.modal editmodal.changing.end",UI._lazyScrollHash[n]).on("shown.bs.modal editmodal.changing.end",e,UI._lazyScrollHash[n]),UI._lazyScrollHash[n](null,e,a[0])}console.timeEnd("initLazyLoad > EACH")}),console.timeEnd("initLazyLoad")},getNewLazyScrollListener:function(){return function(t,e,a){var n=e||t&&t.data,i=(a||t.currentTarget).getBoundingClientRect();n.each(function(){var t=$(this);if(t.parent().is(":visible")){var e=this.getBoundingClientRect(),a=e.top>i.bottom||e.bottom<i.top;if(a&&!t.is(".lazy")&&(t.css("height",t.outerHeight()),t.css("width",t.outerWidth())),!a&&t.is(".lazy")&&(t.css("height",""),t.css("width","")),!a&&t.index()==n.length){var o=+t.parent().attr("data-lazy-loading-index");if(UI._lazyScrollUpdate&&!UI._lazyNoMoreUpdate&&!o){Log.info("LAZY LOADING index: "+o);var r=t.index(),s=t.parent();s.attr("data-lazy-loading-index",r),s.addClass("loading"),setTimeout(function(){UI._lazyScrollUpdate(r,r+UI._lazyChunkSize,function(t){t&&(UI._lazyNoMoreUpdate=!0),setTimeout(function(){s.removeClass("loading"),Log.info("LAZY LOADING COMPLETE! (index:"+ +s.attr("data-lazy-loading-index")+")"),s.attr("data-lazy-loading-index",null)},100)})},100)}}t.toggleClass("lazy",a)}})}},_getNewLazyScrollListener:function(){return function(t,e,a){var n=e||t&&t.data,i=(a||t.currentTarget).getBoundingClientRect();n.forEach(function(t,e){$(t);if($(t.parentElement).is(":visible")){var a=t.getBoundingClientRect(),o=a.top>i.bottom||a.bottom<i.top;if(o&&!t.classList.contains("lazy")&&(t.style.height=t.offsetHeight+"px",t.style.width=t.offsetWidth+"px"),!o&&t.classList.contains("lazy")&&(delete t.style.height,delete t.style.width),!o&&e==n.length-1){var r=+t.parentElement.getAttribute("data-lazy-loading-index");if(UI._lazyScrollUpdate&&!UI._lazyNoMoreUpdate&&!r){Log.info("LAZY LOADING index: "+r);var s=e,l=t.parentElement;l.setAttribute("data-lazy-loading-index",s),l.classList.add("loading"),setTimeout(function(){UI._lazyScrollUpdate(s,s+UI._lazyChunkSize,function(t){t&&(UI._lazyNoMoreUpdate=!0),setTimeout(function(){l.classList.remove("loading"),Log.info("LAZY LOADING COMPLETE! (index:"+ +l.getAttribute("data-lazy-loading-index")+")"),l.removeAttribute("data-lazy-loading-index")},100)})},100)}}t.classList.toggle("lazy",o)}})}},disableLazyLoad:function(){Log.info("UI.disableLazyLoad ... "),$("[data-lazy-load]").addClass("lazy-load-disabled")},enableLazyLoad:function(){Log.info("UI.enableLazyLoad ... "),$("[data-lazy-load]").removeClass("lazy-load-disabled")},initPropagateClick:function(){$(document).on("mousedown","[data-propagate-click]",function(t){t.stopPropagation(),t.stopImmediatePropagation();var e=t.currentTarget.getAttribute("data-propagate-click");return $(e).trigger("click"),!1})},initRichTextField:function(){if($.summernote){var t=$(".richtext:not(.rich-text-init)"),e="😀😁😂😃😄😅😆😇😈😉😊😋😌😍😎😏😐😑😒😓😔😕😖😗😘😙😚😛😜😝😞😟😠😡😢😣😤😥😦😧😨😩😪😫😬😭😮😯😰😱😲😳😴😵😶😷😸😹😺😻😼😽😾😿🙀🙁🙂🙃🙄🙅🙆🙇🙈🙉🙊🙋🙌🙍🙎🙏✊✋✨❌➀➁➂➃➄➅➆➇➈➉➊➋➌➍➎➏➐➑➒➓🚀🚁🚂🚃🚄🚅🚆🚇🚈🚉🚊🚋🚌🚍🚎🚏🚐🚑🚒🚓🚔🚕🚖🚗🚘🚙🚚🚛🚜🚝🚞🚟🚠🚡🚢🚣🚤🚥🚦🚧🚨🚩🚪🚫🚬🚭🚮🚯🚰🚱🚲🚳🚴🚵🚶🚷🚸🚹🚺🚻🚼🚽🚾🚿🛀🛁🛂🛃🛄🛅🛋🛌🛍🛎🛏🛐🛑🛒🛠🛡🛢🛣🛤🛥🛦🛧🛨🛩🛪🛫🛬🛰🛱🛲🛳🛴🛵🛶🛷🛸".match(/.{2,2}/g);$.extend($.summernote.options,{sEmoji:{icon:"😀",tooltip:"Aggiungi Emoji",list:e}}),t.addClass("rich-text-init").summernote({height:100,lang:"it-IT",placeholder:t.attr("placeholder"),disableDragAndDrop:!0,toolbar:[["style",["bold","italic","underline","clear"]],["color",["color"]],["para",["ul","ol","paragraph"]],["insert",["sEmoji"]]],callbacks:{onInit:function(t){t.toolbar.find(".note-current-color-button").attr("data-backcolor","").find("i").attr("style",""),t.toolbar.find(".note-palette:first-child, .note-palette-title, .note-palette > div:first-child").remove(),t.toolbar.find(".dropdown-menu").css("min-width",90)},onPaste:function(t){var e=((t.originalEvent||t).clipboardData||window.clipboardData).getData("Text");t.preventDefault(),document.execCommand("insertText",!1,e)}}})}},_getAttachmentIcon:function(t){switch(String(t).toLowerCase()){case"doc":case"docx":return"f_doc.png";case"pdf":return"f_pdf.png";case"xls":case"xlsx":return"f_xls.png";case"png":return"f_png.png";case"jpeg":case"jpg":return"f_jpg.png"}},initAttachments:function(){$(document).on("change","[type=file].attachment",function(t){var e=t.currentTarget.getAttribute("max-size"),a=t.currentTarget.files[0],n=a.name,i=n.split(".").pop(),o=(new FileReader,$(t.currentTarget)),r=o.closest(".attachment-container");r.find(".filename").text(n),r.find(".extIcon").attr("src",Settings.remoteImageBaseUrl+UI._getAttachmentIcon(i)),r.addClass("has-file"),r.removeClass("error"),a.size>e&&r.addClass("attachment-error attachment-error-size")})},_stickyUID:0,initSticky:function(){$(window).resize(UI._checkStikies),UI._checkStikies()},_checkStikies:function(){var t=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth||screen.width;$("[data-sticky]").each(function(e,a){var n=$(a),i=JSON.parse(a.getAttribute("data-sticky"));!n.is(".sticked")&&i.hasOwnProperty("max-width")&&i["max-width"]>t&&UI._stick(a),n.is(".sticked")&&i.hasOwnProperty("max-width")&&i["max-width"]<=t&&UI._unstick(a)})},_stick:function(t){var e=JSON.parse(t.getAttribute("data-sticky")),a=$(e.container),n=$(t),i=+n.attr("data-sticky-uid");isNaN(i)&&(n.attr("data-sticky-uid",UI._stickyUID),UI._stickyUID++);var o=n.clone(!0);o.removeAttr("data-sticky"),n.addClass("sticked"),a.append(o),n.hide(),$("body").addClass(e.stickyBodyClass)},_unstick:function(t){var e=$(t);e.removeClass("sticked");var a=+e.attr("data-sticky-uid");Log.info("UNSTICK "+a),$("[data-sticky-uid="+a+"]:not([data-sticky])").remove(),e.show(),$("body").removeClass(settings.stickyBodyClass)},initAutoColspan:function(){var t=function(t){return t.map(function(t,e){return+e.getAttribute("colspan")||1}).get().reduce(function(t,e){return t+e},0)},e=function(){$("[data-autocolspan]").each(function(e,a){var n=$(a).closest("table"),i=n.find("tbody"),o=0;if(i.length&&(o=t(i.find("tr:first td:visible"))),!o){var r=n.find("thead");o=t(r.find("tr:first th:visible"))}o-=t($(a).siblings(":visible")),a.setAttribute("colspan",o)})};$(window).resize(e),e()},initSynchHref:function(){$(window).on("browser.url.change",function(t){$("[data-sync-href]").each(function(t,e){$a=$(e);var a=$a.attr("data-origin-href");a||(a=$a.attr("href"),$a.attr("data-origin-href",a));var n=$a.attr("data-sync-href").split(","),i={};n.map(function(t){i[t]=urlParams[t]});var o=a.split("?");$a.attr("href",o[0]+"?"+(o[1]||"")+$.param(i))})})},initCircularProgressBar:function(){var t=$(".handlebar-profile-progress");t.length&&Utils.wrap(t,{progress:MyTeam.getProfileProgress()},function(){$(".chart").each(function(){var t=$(this),e={current:0,percent:t.val()||25,background:t.attr("data-background-color")||"#CCCCCC",foreground:t.attr("data-foreground-color")||"#555555",size:t.attr("data-size")||220,lineWidth:t.attr("data-line")||15,rotate:t.attr("data-rotate")||0},a=document.createElement("canvas");"undefined"!=typeof G_vmlCanvasManager&&G_vmlCanvasManager.initElement(a);var n=a.getContext("2d");a.width=a.height=e.size;var i=$('<div class="chart-frame"></div>');t.after(i),i[0].appendChild(a),n.translate(e.size/2,e.size/2),n.rotate((-.5+e.rotate/180)*Math.PI),t.change(function(){e.percent=t.val(),Draw.refreshCircle(a,e,!0),$(this).closest(".chart-container").find(".chart-value").text(e.percent+"%")}),Draw.refreshCircle(a,e,!0),100==e.percent&&t.closest(".chart-container").addClass("complete")})})},initRepeatRemove:function(){$(document).on("click",'[data-toggle="repeat-remove"]',function(t){var e=$(t.currentTarget).closest("[data-repeat-id]"),a=(e.attr("data-repeat-id"),e.siblings("[data-repeat-id]"));if(a.length>0){e.remove(),a.each(function(t,e){var a=$(e);a.find("[name]").attr("name",function(e,a){return a.replace(/[(\d+)]/g,t)}),a.find("[id]").attr("id",function(e,a){return a.replace(/[(\d+)]/g,t)}),a.find("[data-startendelem]").attr("data-startendelem",function(e,a){return a.replace(/[(\d+)]/g,t)})});var n=e.attr("data-repeat-counter");n&&$(n).val(a.length).trigger("change")}})},_idCountdownInterval:null,initCountdown:function(){var t=$(".countdown");if(t.length){var e=new Date,a=MyLeague.getCountdownMillis();e.setTime(e.getTime()+a);var n=+__.g("li").currentTurn,i=(__.g("li").competitionStartSerieA,+__.g("li").competitionEndSerieA);t.length&&(n>=i-1&&t.addClass("finished"),UI._idCountdownInterval=setTimeout(function(){UI._refreshCountdown(t,e.getTime())},1e3-e.getMilliseconds()),setTimeout(function(){t.addClass("initialized")},1e3))}},_refreshCountdown:function(t,e){var a=Date.now(),n=Math.max(e-a,0),i={ss:Utils.pad(Math.floor(n/1e3)%60),mm:Utils.pad(Math.floor(n/1e3/60)%60),hh:Utils.pad(Math.floor(n/1e3/60/60)%24),dd:Utils.pad(Math.floor(n/1e3/60/60/24)%24)};t.toggleClass("countdown-lt-day",i.dd<1);for(var o in i)[0,1].map(function(e){UI._updateCounter(t.find(".countdown-counter-"+o),i[o],e)});n>0&&setTimeout(function(){UI._refreshCountdown(t,e)},1e3-a%1e3)},_updateCounter:function(t,e,a){t.find(".countdown-counter-digit-"+a).attr("data-current",function(t,n){if(e[a]!=n){var i=$(this);i.removeClass("refresh"),setTimeout(function(){i.addClass("refresh")},1)}return $(this).attr("data-old",n),e[a]})},initLimitedInputs:function(){$(document).on("focus","input.limited",function(t,e,a){}),$(document).on("change","input.limited",function(t,e,a){var n=+this.getAttribute("data-limit-min")||-(1/0),i=+this.getAttribute("data-limit-max")||1/0,o=this.value;return o<i&&o>n?(this.defaultValue=this.value,!0):(this.value=this.defaultValue,!1)})}};$(function(){console.log("DOM READY..."),$(".wait-css-loading").removeClass("wait-css-loading"),loadPartials(onLoadPartials)});var Layout={init:function(){Layout.initWebView(),Layout.initLeagueInfo(),Layout.initHeader(),Layout.initViewport(),Layout.initSideContent(),Layout.initLeftSideNav(),Layout.initSetupCheckList(),Layout.initMainMenu(),Layout.initSecondaryMenu(),Layout.initLeagueIdHref(),Layout.initBreadCrumbs(),Layout.initCompetitionsDropdown(),Layout.initCompetitionsSettings(),Layout.initGroupSelector()},initWebView:function(){urlParams.app&&(Globals.isWebView=!0,Log.info("main.js:WEB-VIEW INIT"),$("body").addClass("webview"),$(document).trigger("fg.init.webview"),$(document).on("click","body [href]",function(t){var e=t.currentTarget;if(e.origin==location.origin&&e.search.toLowerCase().indexOf("app=true")==-1){t.preventDefault();var a=e.href+(e.search?"&":"?")+"app=true";Utils.redirect(a)}}))},initLeagueInfo:function(){var t=__.g("li");Log.info("Auth::initLogin - leagueInfo: ",t),Utils.wrap(".handlebar-league-info",t)},initCompetitionsDropdown:function(){$(document).on("click",".competition-list a[data-id]",function(t){t.preventDefault();var e=$(t.currentTarget),a=+e.attr("data-id"),n=location.protocol+"//"+location.host+location.pathname+"?id="+a;return Utils.redirect(n),!1})},initCompetitionsSettings:function(){var t=$("#competitionDropdown .competition-list [data-id]").map(function(t,e){return{id:e.getAttribute("data-id"),name:e.innerText||e.textContent}}).get();t&&t.length&&Utils.wrap(".competitions-template",{competitions:t},function(){$(".competition-list.sortable").sortable({axis:"y",handle:".sort-handle",items:"> .list-group-item"}),$("#competitionSettingsModal .btn-save").click(function(t){var e=$("#competitionSettingsModal .list-group-item-league"),a=e.map(function(){return this.getAttribute("data-id")}).get();Api.saveCompetitionsPreferences(a,function(t){t&&t.success?($("#competitionSettingsModal").modal("hide"),$list=$("#competitionDropdown .competition-list"),a.map(function(t){$li=$list.find('li:has([data-id="'+t+'"])'),$li.appendTo($list)})):Utils.onResponse("#competitionSettingsModal")(t)},Utils.onResponse("#competitionSettingsModal"))})})},initHeader:function(){if(Globals.isMobile)return $("body").addClass("fixed-header"),void $("#subNavbar").insertBefore($(".viewport"));var t=$(".viewport");$(window).resize(Layout.refreshHeader),t.scroll(Layout.refreshHeader),Layout.refreshHeader(),t.on("click",Layout._onViewportClick)},_onViewportClick:function(t){var e=$(t.currentTarget).elementsUnderPoint(t.pageX,t.pageY).get();e&&e[0]==t.currentTarget&&e.slice(1).some(function(t){return!(!t||!t.tagName||"a"!=t.tagName.toLowerCase()||t.parentNode!=document.body&&!t.classList.contains("adver-link"))&&(t.click(),!0)})},_scrollingTimeout:null,refreshHeader:function(){var t=$("#topNavbar"),e=$("#subNavbar"),a=$(".viewport"),n=($("#adv_Skin"),parseInt(a.css("padding-top"),10)),i=a.offset().top+n;Globals.isMobile||(e.toggleClass("affix",a[0].scrollTop>=i),t.toggleClass("hide",a[0].scrollTop>=i)),a.toggleClass("v-scroll",a[0].scrollHeight>a[0].clientHeight),clearTimeout(Globals._scrollingTimeout),a.addClass("scrolling"),Globals._scrollingTimeout=setTimeout(function(){a.removeClass("scrolling")},200)},initViewport:function(){var t=$("body"),e=($(".viewport"),document.hasFocus());$(window).focus(function(a){t.addClass("focus"),e=!0}),$(window).blur(function(a){t.removeClass("focus"),e=!1})},initSideContent:function(){var t=$(".viewport");$(window).resize(Layout.refreshSideContent),t.scroll(Layout.refreshSideContent)},refreshSideContent:function(){var t=$(".viewport"),e=parseInt(t.css("padding-top"),10),a=$(".main-content"),n=$(".side-content");if(n.length){n.css("top","");var i=a.offset().top,o=a.children().map(function(){return $(this).position().top+$(this).outerHeight(!0)}).get().reduce(function(t,e){return t>e?t:e},0),r=n.children().map(function(){return $(this).position().top+$(this).outerHeight(!0)}).get().reduce(function(t,e){return t>e?t:e},0),s=(a.position().top,o-r),l=-i+e;l>0?l<s?n.css("top",l):n.css("top",Math.max(0,s)):n.css("top",0)}},initRightSideNav:function(){var t=$("body");$(".user-info .dropdown").off("show.bs.dropdown").on("show.bs.dropdown",function(){t.addClass("right-sidenav-open")}),$(".user-info .dropdown").off("hide.bs.dropdown").on("hide.bs.dropdown",function(){t.removeClass("right-sidenav-open")})},initLeftSideNav:function(){var t=$("body"),e=$(".navbar-collapse");e.on("show.bs.collapse",function(){t.addClass("left-sidenav-open")}),e.on("hide.bs.collapse",function(){t.removeClass("left-sidenav-open")}),$(document).on("click","body.left-sidenav-open",function(t){t.target==t.currentTarget&&e.collapse("hide")})},initLeaguesOptionsList:function(){$(".sortable").sortable({axis:"y",handle:".sort-handle",items:"> .list-group-item"}),$(document).on("click",".competition-ghost-icon",function(){$(this).closest(".list-group-item").toggleClass("ghost")}),$("#yourCompetitionsModal .btn-save").click(function(t){var e=$("#yourCompetitionsModal .list-group-item-league"),a=e.map(function(t){var e=$(this);return e.attr("data-id")+"|"+(e.is(".ghost")?0:1)}).get();Api.savePreferences(a,function(t){t&&t.success?($("#yourCompetitionsModal").modal("hide"),a.reverse().map(function(t){var e=t.split("|"),a=$(".panel-my-leagues [data-id='"+e[0]+"']");1==e[1]?a.removeClass("hidden").prependTo(a.parent()):a.addClass("hidden")})):Utils.onResponse("#yourCompetitionsModal")(t)},Utils.onResponse("#yourCompetitionsModal"))})},initSetupCheckList:function(){var t=$(".setup-check-list");t.length&&t.find("[data-page]").each(function(){var t=$(this);t.attr("data-page").split(",").map(function(e){e&&Boolean(location.pathname.match(String(e).trim()))&&(t.addClass("current"),t.find(".collapse").addClass("in"))})})},initMainMenu:function(){var t=$(".main-menu");t.find(".active").removeClass("active");var e=window.location.pathname.replace(MyLeague.getAlias(),""),a=e.slice(1)||"home";Log.info("main.js::initMainMenu - current page: "+a),t.find('[href*="'+a+'"]:first()').closest("li").addClass("active");var n=$(".navbar-autoscroll");if(n.length){var i=n.find(".autoscroll-left .btn"),o=n.find(".autoscroll-right .btn"),r=function(){var t=n.scrollLeft();i.prop("disabled",t<=0),o.prop("disabled",t>=n[0].scrollWidth-n[0].clientWidth),t<=0&&t>=n[0].scrollWidth-n[0].clientWidth?(i.parent().fadeOut(),o.parent().fadeOut(),n.addClass("unscrollable")):(i.parent().fadeIn(),o.parent().fadeIn(),n.removeClass("unscrollable"))};o.on("click",function(t){var e=n.scrollLeft();n.animate({scrollLeft:e+300},200,"easeInOutQuint",function(){r()})}),i.on("click",function(t){var e=n.scrollLeft();n.animate({scrollLeft:e-300},200,"easeInOutQuint",function(){r()})}),$(window).on("resize",r),r()}},initSecondaryMenu:function(){var t=$(".secondary-menu");t.find(".active").removeClass("active");var e=window.location.pathname.slice(1).split("/")[1]||"/";Log.info("main.js::initSecondaryMenu - current page: "+e),t.find('[href*="'+e+'"]:first()').closest("li").addClass("active")},initLeagueIdHref:function(){var t=__.g("li");if(t){var e=+t.id;$("[data-league-id]").attr("href",function(t,a){return a+"/"+e}),$("[data-league-section]").attr("href",function(t,e){if(document.location.href.match(MyLeague.getUrl())){return e+document.location.href.replace(MyLeague.getUrl(),"/")}return e})}if(t){var a=+__.g("li").competitionId;$("[data-competition-id]").attr("href",function(t,e){return e+"/"+a})}},initBreadCrumbs:function(){},refreshLeagueHeader:function(){var t=Globals.getCurrentLeagueInfo(),e=String(Leagues.TYPES[t.type]).toLowerCase();$(".league-type").removeClass(function(t,e){return(e.match(/(^|\s)text-\S+/g)||[]).join(" ")}).addClass("text-"+e).text(e)},initGroupSelector:function(){var t=$(".group-results");t.find(".group-item[data-id]").click(function(e){t.attr("data-cur-group",e.currentTarget.getAttribute("data-id"))})}},Auth={initLogin:function(){var t=Globals.storeCredentials?LocalStorage.get("lastLoginInfo"):{};Utils.wrap(".handlebars-login-form-template",t),Validations.register('form[name="login"]',function(t){var e=Utils.getUrlAlias(),a=Utils.getFormData($(t));return Globals.storeCredentials&&LocalStorage.set("lastLoginInfo",a),$("body").addClass("logging"),Api.login(a.username,a.password,e,function(t){$("body").is(".leagues")?Utils.refresh():Auth.onLoginSuccess(t)},Utils.onResponse($(t).closest(".box-login"))).done(function(t){$("body").removeClass("logging")})});var e=__.g("u");e&&!$.isEmptyObject(e)?(Log.info("main.js::initLogin - Utente loggato: ",e),Auth.onLoginSuccess({data:e})):(__.g("e")&&Utils.parseServerError(__.g("e"),"Accesso non riuscito..."),Log.info("main.js::initLogin - Utente NON loggato "),Globals.onLogout(!0)),$(document).on("click",".login-facebook",Auth.loginWithFacebook)},onLoginSuccess:function(t){Log.info("main.js::onLoginSuccess - loginData: ",t),$(document).trigger("fg.user.loggedin"),Globals.updateUserInfo(t),urlParams.hasOwnProperty("from")?Globals.isConfirmed()?Utils.redirect("1"==urlParams.from?"unisci-lega":"crea-lega"):Utils.redirect("conferma-iscrizione?from="+urlParams.from):($("#loginModal").modal("hide"),Layout.initRightSideNav(),Layout.initLeaguesOptionsList())},onLoginFail:function(t,e){e?Utils.onResponse(e)(t):(Log.info("main.js::onLoginFail - Tentativo di auto login fallito!"),t&&t.error_msgs&&t.error_msgs[0]&&"KK02"==t.error_msgs[0].id||Globals.logout(!0),Log.info("main.js::onLoginFail - response:",t))},loginWithFacebook:function(t){Log.info("main.js::loginWithFacebook...");var e=$(t.target).closest(".login-with-facebook")[0];Globals.facebookInfo?Auth.onInitFBM(e):($(document).on("fg.facebook.initialized",function(){Auth.onInitFBM(e)}),FBManager.init())},onInitFBM:function(t){$(document).off("fg.facebook.initialized",Auth.onInitFBM);var e=FBManager.getCurrentToken();e?Auth.onFacebookToken(t,e):FBManager.connect(function(e){FBManager.getCurrentUserId()?onFacebookToken(t,FBManager.getCurrentToken()):Utils.onResponse(t,Str.get("fb-login-failed"))(e)})},onFacebookToken:function(t,e){$("body").addClass("logging"),Api.loginFB(e,Auth.onLoginSuccess,Utils.onResponse(t,Str.get("fb-login-failed"))).done(function(t){$("body").removeClass("logging")})}},_MANTRA_ROLE_SPLITTER=/[A-Z][a-z]{0,2}/g,_ROLE_INDEX={p:1,por:1,ds:2,dc:2,dd:2,d:2,e:5,m:3,c:4,w:6,t:7,a:8,pc:9};$.expr[":"].contains=$.expr.createPseudo(function(t){return function(e){return $(e).text().toUpperCase().indexOf(t.toUpperCase())>=0}});